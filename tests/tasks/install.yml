---
# Tests Ruby 2 is installed correctly

- name: determine if ruby packages are installed - CentOS
  command: rpm -qa
  when: ansible_distribution == "CentOS"
  changed_when: False
  register: ruby2_test_fact_ruby_packages_are_installed
- name: assert ruby packages are installed
  assert:
    that:
      - "'ruby-' in ruby2_test_fact_ruby_packages_are_installed.stdout"
      - "'ruby-devel' in ruby2_test_fact_ruby_packages_are_installed.stdout"
  when: ansible_distribution == "CentOS"

- name: determine if ruby package is installed - Ubuntu
  command: dpkg -s ruby2.2
  when: ansible_distribution == "Ubuntu" and
    (BARC_use_non_system_package_sources == true or BARC_use_non_system_package_sources == 'True')
  changed_when: False
  register: ruby2_test_fact_ruby_package_is_installed
- name: determine if ruby development package is installed - Ubuntu
  command: dpkg -s ruby2.2-dev
  when: ansible_distribution == "Ubuntu" and
    (BARC_use_non_system_package_sources == true or BARC_use_non_system_package_sources == 'True')
  changed_when: False
  register: ruby2_test_fact_ruby_development_package_is_installed
- name: assert ruby packages are installed
  assert:
    that:
      - "'install ok installed' in ruby2_test_fact_ruby_package_is_installed.stdout"
      - "'install ok installed' in ruby2_test_fact_ruby_development_package_is_installed.stdout"
  when: ansible_distribution == "Ubuntu" and
    (BARC_use_non_system_package_sources == true or BARC_use_non_system_package_sources == 'True')

- name: determine if ruby package is installed - Ubuntu
  command: dpkg -s ruby2.0
  when: ansible_distribution == "Ubuntu" and
    (BARC_use_non_system_package_sources == false or BARC_use_non_system_package_sources == 'False')
  changed_when: False
  register: ruby2_test_fact_ruby_package_is_installed
- name: determine if ruby development package is installed - Ubuntu
  command: dpkg -s ruby2.0-dev
  when: ansible_distribution == "Ubuntu" and
    (BARC_use_non_system_package_sources == false or BARC_use_non_system_package_sources == 'False')
  changed_when: False
  register: ruby2_test_fact_ruby_development_package_is_installed
- name: assert ruby packages are installed
  assert:
    that:
      - "'install ok installed' in ruby2_test_fact_ruby_package_is_installed.stdout"
      - "'install ok installed' in ruby2_test_fact_ruby_development_package_is_installed.stdout"
  when: ansible_distribution == "Ubuntu" and
    (BARC_use_non_system_package_sources == false or BARC_use_non_system_package_sources == 'False')
